
class Memory
  MEMORY_SIZE = 4096

  def initialize
    @memory = Array.new(MEMORY_SIZE, 0)

    sprites = [
      0xf0, 0x90, 0x90, 0x90, 0xf0, # 0 
      0x20, 0x60, 0x20, 0x20, 0x70, # 1
      0xf0, 0x10, 0xf0, 0x80, 0xf0, # 2
      0xf0, 0x10, 0xf0, 0x10, 0xf0, # 3
      0x90, 0x90, 0xf0, 0x10, 0x10, # 4
      0xf0, 0x80, 0xf0, 0x10, 0xf0, # 5
      0xf0, 0x80, 0xf0, 0x90, 0xf0, # 6
      0xf0, 0x10, 0x20, 0x40, 0x40, # 7
      0xf0, 0x90, 0xf0, 0x90, 0xf0, # 8
      0xf0, 0x90, 0xf0, 0x10, 0xf0, # 9
      0xf0, 0x90, 0xf0, 0x90, 0x90, # a
      0xe0, 0x90, 0xe0, 0x90, 0xe0, # b
      0xf0, 0x80, 0x80, 0x80, 0xf0, # c
      0xe0, 0x90, 0x90, 0x90, 0xe0, # d
      0xf0, 0x80, 0xf0, 0x80, 0xf0, # e
      0xf0, 0x80, 0xf0, 0x80, 0x80, # 6
    ]

    write(0x00, *sprites)
  end

  def write(address, *content)
    content.each_with_index do |value, index|
      @memory[address+index] = value
    end
  end

  def fetch(pc)
    self[pc] + self[pc+1]
  end

  def [](address)
    @memory[address].to_s(16).rjust(2, "0")
  end

  def size
    MEMORY_SIZE
  end

  def to_s(from, to)
    result = ""
    from.upto(to) do |i|
      result += "#{hex(i)}: #{hex(@memory[i])}\n"
    end
    result
  end

end
